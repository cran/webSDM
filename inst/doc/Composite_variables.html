<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Composite variables and biotic-abiotic interactions</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Composite variables and biotic-abiotic
interactions</h1>



<p>In this vignette we explain how to use composite variables in trophic
SDM. These variables are useful especially in species-rich network,
where some predators might have so many preys that assuming that each of
them has a differential effect on predator distribution is not only a
problem, but might seem ecologically unjustified. Instead, we could
expect the richness or diversity of prey, or whether at least a prey is
available, to be important. Hence, we implemented the use of composite
variables, i.e., variables that summarize the information of a large
number of variables from the graph in a few summary variables. Examples
of composite variables are prey richness or diversity, or a binary
variable set to one if the number of preys is above a certain threshold.
These variables assume that all species have the same impact on the
predator. An alternative is to group species in the metaweb to represent
trophic groups that clump together species that feed on, or are eaten
by, the same type of species. We can then construct composite variables
(e.g., their richness) for each of those trophic groups to better
represent the variety of resources for species like generalist or top
predators.<br />
In <code>webSDM</code> it is possible to define an extremely large set
of composite variables using the arguments <code>sp.formula</code> and
<code>sp.partition</code>. In general, <code>sp.formula</code> allows
the definition of the composite variables, while
<code>sp.partition</code> allow to define the groups of preys (or
predator) for which each composite variable is calculate. Hereafter we
don’t provide a complete analyses of a case-study using composite
variables, but rather focus on the description of how to implement them
in <code>webSDM</code>. Finally, we will see how to include an
interaction between preys and the environment.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(webSDM)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">data</span>(X ,Y, G)</span></code></pre></div>
<div id="composite-variables" class="section level2">
<h2>Composite variables</h2>
<p><code>sp.formula</code> can be a right hand side formula including
richness (i.e. the sum of its preys) and any transformations of
richness. Notice that only “richness” is allowed for now. However, we
will see how this already allow to build an extremely large set of
composite variable. We start with a simple case where we model species
as a function of the richness of their prey, with a polynomial of degree
two.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>m <span class="ot">=</span> <span class="fu">trophicSDM</span>(Y, X, G,</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>               <span class="at">env.formula =</span> <span class="st">&quot;~ X_1 + X_1^2&quot;</span>, </span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">penal =</span> <span class="cn">NULL</span>, </span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>               <span class="at">sp.formula =</span> <span class="st">&quot;richness + I(richness^2)&quot;</span>,</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>               <span class="at">mode =</span> <span class="st">&quot;prey&quot;</span>, <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt; Formula was modified since it led to identical columns of the design matrix (e.g. Y_1 or Y_1^2 for binary data)</span></span></code></pre></div>
<p>Notice that for predators that feed on a single prey (with
presence-absence data), their richness and the square of their richness
is exactly the same variable. In this case, <code>trophicSDM()</code>
removes the redundant variable but prints a warning message. We can see
the formulas created by the argument <code>$form.all</code> of the
fitted model.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>m<span class="sc">$</span>form.all</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt; $Y1</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1 + X_1^2&quot;</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt; $Y2</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1 + X_1^2&quot;</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; $Y3</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1 + X_1^2&quot;</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; $Y5</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1+I(Y1 + Y2 + Y3)+I(I(Y1 + Y2 + Y3)^2)&quot;</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt; $Y4</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1+I(Y3)&quot;</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="co">#&gt; $Y6</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1+I(Y3 + Y5)+I(I(Y3 + Y5)^2)&quot;</span></span></code></pre></div>
<p>We now set as composite variable a dummy variable specifying whether
there is at least one available prey or not. To do so we define
<code>sp.formula = &quot;I(richness&gt;0)&quot;</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>m <span class="ot">=</span> <span class="fu">trophicSDM</span>(Y,X,G,</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>               <span class="at">env.formula =</span> <span class="st">&quot;~ X_1 + X_1^2&quot;</span>, </span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">penal =</span> <span class="cn">NULL</span>, </span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>               <span class="at">sp.formula =</span> <span class="st">&quot;I(richness&gt;0)&quot;</span>,</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>               <span class="at">mode =</span> <span class="st">&quot;prey&quot;</span>, <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>)</span></code></pre></div>
<p>Which leads to the following formulas:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>m<span class="sc">$</span>form.all</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt; $Y1</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1 + X_1^2&quot;</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; $Y2</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1 + X_1^2&quot;</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; $Y3</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1 + X_1^2&quot;</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt; $Y5</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1+I(I(Y1 + Y2 + Y3) &gt; 0)&quot;</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt; $Y4</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1+I(I(Y3) &gt; 0)&quot;</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt; $Y6</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1+I(I(Y3 + Y5) &gt; 0)&quot;</span></span></code></pre></div>
</div>
<div id="composite-variables-and-groups-of-preys" class="section level2">
<h2>Composite variables and groups of preys</h2>
<p>A halfway between considering that each species has a differential
effect on the predator (i.e., no composite variable), or that every prey
has the same effect (i.e., modeling predator as a function of prey
richness), is to create group of species that we assume to have the same
effect on the predator. Then, we can model predator as a function of
composite variables calculated on each of these groups. To do so, we
rely on the argument <code>sp.partition</code>. This parameters has to
be a list, where each element contain the species of the given
group.<br />
For example, we can put species Y1 and Y2 in the same group, species Y3
and Y4 are alone in their group and Y5 and Y6 to form another group.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>sp.partition <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;Y1&quot;</span>,<span class="st">&quot;Y2&quot;</span>),<span class="fu">c</span>(<span class="st">&quot;Y3&quot;</span>),<span class="fu">c</span>(<span class="st">&quot;Y4&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;Y5&quot;</span>,<span class="st">&quot;Y6&quot;</span>))</span></code></pre></div>
<p>Then, we can specify whatever <code>sp.formula</code>, for example
using richness (with a quadratic term).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>m <span class="ot">=</span> <span class="fu">trophicSDM</span>(Y,X,G, <span class="st">&quot;~ X_1 + X_1^2&quot;</span>, </span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">penal =</span> <span class="cn">NULL</span>, </span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>               <span class="at">sp.partition =</span> sp.partition,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>               <span class="at">sp.formula =</span> <span class="st">&quot;richness + I(richness^2)&quot;</span>,</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>               <span class="at">mode =</span> <span class="st">&quot;prey&quot;</span>, <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; Formula was modified since it led to identical columns of the design matrix (e.g. Y_1 or Y_1^2 for binary data)</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; Formula was modified since it led to identical columns of the design matrix (e.g. Y_1 or Y_1^2 for binary data)</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; Formula was modified since it led to identical columns of the design matrix (e.g. Y_1 or Y_1^2 for binary data)</span></span></code></pre></div>
<p>Which leads to the following formulas:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>m<span class="sc">$</span>form.all</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#&gt; $Y1</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1 + X_1^2&quot;</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt; $Y2</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1 + X_1^2&quot;</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; $Y3</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1 + X_1^2&quot;</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; $Y5</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1+I((Y1 + Y2))+I(I((Y1 + Y2)^2))+I((Y3))&quot;</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt; $Y4</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1+I((Y3))&quot;</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt; $Y6</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1+I((Y3))+I((Y5))&quot;</span></span></code></pre></div>
</div>
<div id="custom-formula" class="section level2">
<h2>Custom formula</h2>
<p>In case we want to specify a composite variable that cannot be
created from a function of richness, the user can specify directly the
list of the biotic formulas in the <code>sp.formula</code> argument.
Importantly, notice that in this case <code>trophicSDM()</code> will not
create a new formula from the argument <code>G</code> and will not check
that the user-defined formula actually derives from <code>G</code>
(i.e. that predator-prey interactions described in the formulas derive
from G). For example, we might want to quantify the effect of the prey
Y5 on the predator Y6 when the prey Y3 is not available. To do so, we
define for species Y6 an interaction term between species Y5 and one
minus Y3 (i.e. a dummy variable that takes the value of 1 when species
Y5 is present and Y3 is absent). To do so, we define
<code>sp.formula</code> as a list describing the biotic formula for each
species.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>sp.formula <span class="ot">=</span> <span class="fu">list</span>(<span class="at">Y1 =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>                  <span class="at">Y2 =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>                  <span class="at">Y3 =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>                  <span class="at">Y4 =</span> <span class="st">&quot;Y3&quot;</span>,</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>                  <span class="at">Y5 =</span> <span class="st">&quot;Y1&quot;</span>,</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>                  <span class="at">Y6 =</span> <span class="st">&quot;I(Y5*(1-Y3))&quot;</span>)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>m <span class="ot">=</span> <span class="fu">trophicSDM</span>(Y,X,G, <span class="st">&quot;~ X_1 + X_1^2&quot;</span>, </span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">penal =</span> <span class="cn">NULL</span>, </span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>               <span class="at">sp.formula =</span> sp.formula,</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>               <span class="at">mode =</span> <span class="st">&quot;prey&quot;</span>, <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>)</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt; We don&#39;t check that G and the graph induced by the sp.formula specified by the user match, nor that the latter is a graph. Please be careful about their consistency.</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>m<span class="sc">$</span>form.all</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt; $Y1</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1 + X_1^2&quot;</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="co">#&gt; $Y2</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1 + X_1^2&quot;</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="co">#&gt; $Y3</span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1 + X_1^2&quot;</span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a><span class="co">#&gt; $Y5</span></span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1+Y1&quot;</span></span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a><span class="co">#&gt; $Y4</span></span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1+Y3&quot;</span></span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a><span class="co">#&gt; $Y6</span></span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a><span class="co">#&gt; [1] &quot;y ~ X_1+I(Y5 * (1 - Y3))&quot;</span></span></code></pre></div>
</div>
<div id="on-computevariableimportance-with-composite-variable" class="section level2">
<h2>On computeVariableImportance with composite variable</h2>
<p>When computing the importance of variables using the function
<code>computeVariableImportance</code>, you should be careful with the
definition of groups. Indeed, the function computes the variable
importance of each group as the sum of the standardised regression
coefficients containing some variables from the groups. Therefore, if
species from different groups of variable are merged in the same
composite variable, <code>computeVariableImportance</code> will sum the
regression coefficient of the composite variable in different groups,
leading to wrong results. For example, if
<code>sp.formula = &quot;richness&quot;</code> and
<code>sp.partition = NULL</code>, you should put all species in the same
group in the argument <code>groups</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>m <span class="ot">=</span> <span class="fu">trophicSDM</span>(Y,X,G,</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>               <span class="at">env.formula =</span> <span class="st">&quot;~ X_1 + X_1^2&quot;</span>, </span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">penal =</span> <span class="cn">NULL</span>, </span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>               <span class="at">sp.formula =</span> <span class="st">&quot;richness + I(richness^2)&quot;</span>,</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>               <span class="at">mode =</span> <span class="st">&quot;prey&quot;</span>, <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>)</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; Formula was modified since it led to identical columns of the design matrix (e.g. Y_1 or Y_1^2 for binary data)</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="fu">computeVariableImportance</span>(m, <span class="at">groups =</span> <span class="fu">list</span>(<span class="st">&quot;abiotic&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;X_1&quot;</span>, <span class="st">&quot;X_2&quot;</span>),</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>                                           <span class="st">&quot;biotic&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Y1&quot;</span>, <span class="st">&quot;Y2&quot;</span>, <span class="st">&quot;Y3&quot;</span>,</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>                                                        <span class="st">&quot;Y4&quot;</span>, <span class="st">&quot;Y5&quot;</span>, <span class="st">&quot;Y6&quot;</span>)))</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt; Warning in computeVariableImportance(m, groups = list(abiotic = c(&quot;X_1&quot;, : If you use composite variables, you</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; should group together species that belong to the same composite variable. For example, if sp.formula = &#39;richness&#39; and</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt; sp.partition = NULL, you should put all species in the same group in the argument &#39;groups&#39;. If you define a partition</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt; of species in sp.partition, then species in the same group in sp.partition should put all species in the same group</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">#&gt; in the argument &#39;groups&#39;</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co">#&gt;         Y1 Y2 Y3         Y5         Y4         Y6</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="co">#&gt; abiotic  0  0  0 0.05380788 0.17251449 0.04623329</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="co">#&gt; biotic   0  0  0 0.08470730 0.07633953 0.38116851</span></span></code></pre></div>
<p>If you use composite variables, you should group together species
that belong to the same composite variable.If you define a partition of
species in sp.partition, then species in the same group in sp.partition
should put all species in the same group in the argument ‘groups’.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>sp.partition <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;Y1&quot;</span>,<span class="st">&quot;Y2&quot;</span>),<span class="fu">c</span>(<span class="st">&quot;Y3&quot;</span>),<span class="fu">c</span>(<span class="st">&quot;Y4&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;Y5&quot;</span>,<span class="st">&quot;Y6&quot;</span>))</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>m <span class="ot">=</span> <span class="fu">trophicSDM</span>(Y,X,G, <span class="st">&quot;~ X_1 + X_1^2&quot;</span>, </span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">penal =</span> <span class="cn">NULL</span>, </span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>               <span class="at">sp.partition =</span> sp.partition,</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>               <span class="at">sp.formula =</span> <span class="st">&quot;richness + I(richness^2)&quot;</span>,</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>               <span class="at">mode =</span> <span class="st">&quot;prey&quot;</span>, <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>)</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt; Formula was modified since it led to identical columns of the design matrix (e.g. Y_1 or Y_1^2 for binary data)</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">#&gt; Formula was modified since it led to identical columns of the design matrix (e.g. Y_1 or Y_1^2 for binary data)</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#&gt; Formula was modified since it led to identical columns of the design matrix (e.g. Y_1 or Y_1^2 for binary data)</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="fu">computeVariableImportance</span>(m, <span class="at">groups =</span> <span class="fu">list</span>(<span class="st">&quot;abiotic&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;X_1&quot;</span>, <span class="st">&quot;X_2&quot;</span>),</span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>                                           <span class="st">&quot;Group1&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Y1&quot;</span>, <span class="st">&quot;Y2&quot;</span>),</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>                                           <span class="st">&quot;Group2&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Y3&quot;</span>),</span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>                                           <span class="st">&quot;Group3&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Y4&quot;</span>, <span class="st">&quot;Y5&quot;</span>, <span class="st">&quot;Y6&quot;</span>)))</span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="co">#&gt; Warning in computeVariableImportance(m, groups = list(abiotic = c(&quot;X_1&quot;, : If you use composite variables, you</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="co">#&gt; should group together species that belong to the same composite variable. For example, if sp.formula = &#39;richness&#39; and</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#&gt; sp.partition = NULL, you should put all species in the same group in the argument &#39;groups&#39;. If you define a partition</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="co">#&gt; of species in sp.partition, then species in the same group in sp.partition should put all species in the same group</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a><span class="co">#&gt; in the argument &#39;groups&#39;</span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a><span class="co">#&gt;         Y1 Y2 Y3        Y5         Y4         Y6</span></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a><span class="co">#&gt; abiotic  0  0  0 0.1016899 0.17251449 0.03603087</span></span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a><span class="co">#&gt; Group1   0  0  0 0.8621983 0.00000000 0.00000000</span></span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a><span class="co">#&gt; Group2   0  0  0 0.2581345 0.07633953 0.22671385</span></span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a><span class="co">#&gt; Group3   0  0  0 0.0000000 0.00000000 0.11579149</span></span></code></pre></div>
</div>
<div id="interaction-with-biotic-and-abiotic-terms" class="section level2">
<h2>Interaction with biotic and abiotic terms</h2>
<p>Assuming that the effect of prey on predators does not vary with
environmental conditions might be a too strong assumption. In order to
integrate species plasticity, it is possible to define a
<code>sp.formula</code> that includes both biotic and abiotic terms. For
example, we hereafter define an interaction between the prey and the
environmental variable X_2.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>sp.formula <span class="ot">=</span> <span class="fu">list</span>(<span class="at">Y1 =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>                  <span class="at">Y2 =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>                  <span class="at">Y3 =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>                  <span class="at">Y4 =</span> <span class="st">&quot;I(X_2*Y3)&quot;</span>,</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>                  <span class="at">Y5 =</span> <span class="st">&quot;I(X_2*Y1)&quot;</span>,</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>                  <span class="at">Y6 =</span> <span class="st">&quot;I(X_2*Y3) + I(X_2*Y5)&quot;</span>)</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>m <span class="ot">=</span> <span class="fu">trophicSDM</span>(Y,X,G,</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>               <span class="at">env.formula =</span> <span class="st">&quot;~ X_1 + X_1^2&quot;</span>, </span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">penal =</span> <span class="cn">NULL</span>, </span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>               <span class="at">sp.formula =</span> sp.formula,</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>               <span class="at">mode =</span> <span class="st">&quot;prey&quot;</span>, <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>)</span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co">#&gt; We don&#39;t check that G and the graph induced by the sp.formula specified by the user match, nor that the latter is a graph. Please be careful about their consistency.</span></span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
